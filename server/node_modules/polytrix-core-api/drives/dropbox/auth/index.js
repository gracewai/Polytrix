var config = require('../../config').dropbox;
var filefog = require('../filefog');
var Q = require('q');


module.exports.authUrl = function(){
	return 'https://www.dropbox.com/1/oauth2/authorize?'+
	'redirect_uri='+encodeURIComponent(config.redirect_url)+
	'&response_type=code&client_id='+encodeURIComponent(config.client_key)+
	'&force_reapprove=true';
	//return filefog.provider.oAuthGetAuthorizeUrl();
};

module.exports.getToken = function(code){
	return filefog.provider.oAuthGetAccessToken(code)
	.then(function(results)
	{
		console.log(results);
		return {
			driveid: 'db' + results._raw.uid,
			expires_on: new Date(results.expires_on),
			access_token: results.access_token,
			refresh_token: null
		};
	})
	.catch(function(err){
		console.log(err);
		return err;
	});
};

module.exports.renewToken = function(refresh_token){
	console.log('!logical ERROR, should not call renewToken for dropbox');
	return Q('!logical ERROR, should not call renewToken for dropbox');
};