var filefog = require('../filefog');
var Q = require('q');
var Authenticator = require('../authenticator');
// metadata
//	get(access_token,refresh_token,fileId,fileId)
//	listFile(access_token,refresh_token,fileId)
//	downloadUrl(access_token,refresh_token,fileId)

module.exports.get = function(access_token,refresh_token,fileId){
	return filefog.client(access_token,null)
		.then(function (client) {
			return client.getFileInformation(fileId);
		}).then(function(result){
			result.success = true;
			return result;
		}).catch(function (err){
			console.log(err);
			var result = {
				success: false,
				msg: err.status==404 ? '404 file not found' : err.response.error
			};
			return result;
		});
};

module.exports.listFile = function(access_token,refresh_token,fileId){
	return filefog.client(access_token,null)
	.then(function (client) {
		return client.retrieveFolderItems(location);
	}).then(function(result){
		result.success = true;
		return result;
	}).catch(function (err){
		console.log(err);
		var result = {
			success: false,
			msg: err.status==404 ? '404 file not found' : err.response.error
		}
		return result;
	});
};

module.exports.downloadUrl = function(access_token,refresh_token,fileId){
	return Authenticator.get(access_token,'https://api.dropbox.com/1/media/auto/' + fileId)
	.then(function(body){
		body = JSON.parse(body);
		return body.url;
	});
};