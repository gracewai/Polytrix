var filefog = require('../filefog');
var authenticator = require('../authenticator');
var Q = require('q');

module.exports.accountInfo = function(access_token,refresh_token){
	return filefog.client(access_token,refresh_token)
	.then(function (client) {
		return client.accountInfo();
	})
	.then(transformAccountInfo);
};

module.exports.usageQouta = function(access_token,refresh_token){
	// var url = 'https://www.googleapis.com/drive/v2/about';
	// return authenticator.get(access_token,url)
	// .then(function(body){
	// 	result = {
	// 		username: body.name,
	// 		totalQuota: body.quotaBytesTotal,
	// 		usedQuota: body.quotaBytesUsed
	// 	};
	// 	return result;
	// });
	return filefog.client(access_token,refresh_token)
	.then(function(client){
		return client.checkQuota();
	});
};

function transformAccountInfo(accountInfo){
	accountInfo.email = accountInfo.email || accountInfo._raw.user.emailAddress;
	return accountInfo;
}


// accountInfo
// { name: 'Ka Ho So',
//   email: '',
//   avatar_url: '',
//   created_date: null,
//   modified_date: null,
//   id: '09966738586574842813',



// usageQouta
// { total_bytes: -1073741824,
//   used_bytes: 13212907,
//   limits: { upload_size: '10737418240' },



// accountInfo & usageQouta
//   _raw: 
//    { kind: 'drive#about',
//      etag: '"zWM2D6PBtLRQKuDNbaQNSNEy5BE/xxk4Q_dNI9tmwsi2Ug0WLRYUlQA"',
//      selfLink: 'https://www.googleapis.com/drive/v2/about?includeSubscribed=true',
//      name: 'Ka Ho So',
//      user: 
//       { kind: 'drive#user',
//         displayName: 'Ka Ho So',
//         isAuthenticatedUser: true,
//         permissionId: '09966738586574842813',
//         emailAddress: 'ooloos555@gmail.com' },
//      quotaBytesTotal: '16106127360',
//      quotaBytesUsed: '13212907',
//      quotaBytesUsedAggregate: '13212907',
//      quotaBytesUsedInTrash: '0',
//      quotaType: 'LIMITED',
//      quotaBytesByService: [ [Object], [Object], [Object] ],
//      largestChangeId: '987',
//      rootFolderId: '0AOc3nh6wFb5CUk9PVA',
//      domainSharingPolicy: 'allowed',
//      permissionId: '09966738586574842813',
//      importFormats: 
//       [ [Object],
//         [Object],
//         [Object],
//         [Object],
//         [Object],
//         [Object],
//         [Object],
//         [Object],
//         [Object],
//         [Object] ],
//      exportFormats: [ [Object], [Object], [Object], [Object], [Object], [Object] ],
//      additionalRoleInfo: [ [Object], [Object], [Object], [Object], [Object], [Object] ],
//      features: [ [Object], [Object] ],
//      maxUploadSizes: [ [Object], [Object], [Object], [Object], [Object], [Object] ],
//      isCurrentAppInstalled: false,
//      languageCode: 'zh-TW',
//      folderColorPalette: 
//       [ '#ac725e',
//         '#d06b64',
//         '#f83a22',
//         '#fa573c',
//         '#ff7537',
//         '#ffad46',
//         '#fad165',
//         '#fbe983',
//         '#b3dc6c',
//         '#7bd148',
//         '#16a765',
//         '#42d692',
//         '#92e1c0',
//         '#9fe1e7',
//         '#9fc6e7',
//         '#4986e7',
//         '#9a9cff',
//         '#b99aff',
//         '#a47ae2',
//         '#cd74e6',
//         '#f691b2',
//         '#cca6ac',
//         '#cabdbf',
//         '#8f8f8f' ] } }