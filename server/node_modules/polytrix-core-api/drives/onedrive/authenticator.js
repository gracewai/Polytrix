var request = require('request');
var Q = require('q');
var Authenticator = require('../authenticator');

module.exports = Authenticator(function(method,access_token,api_url,options){
	
	options.url = api_url;
	options.expectedStatus = options.expectedStatus || 200;

	if(method == 'get'){
		options.qs = options.qs || {};
		options.qs.access_token = access_token;
	}else{
		options.headers = options.headers || {};
		options.headers.Authorization = "Bearer " + access_token;
	}


	return Q.Promise(function(resolve,reject){
		request[method](
			options,
			function(error,response,body){
				if(!error){
					if(response.statusCode == options.expectedStatus){
						resolve(body);
					}else{
						console.log('response.statusCode: ' + response.statusCode);
						console.log(body);
						reject(body);
					}
				}else{
					reject(error);
				}
			}
		);
	});
});