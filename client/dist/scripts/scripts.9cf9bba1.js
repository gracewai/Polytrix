"use strict";function _browse_getFileType_(a){return a.split(".").pop()}function _browse_getClass_(a){switch(a.is_folder){case!0:return"fa fa-folder-o";case!1:switch(_browse_getFileType_(a.name)){case"mkv":case"mp4":case"avi":case"wmv":case"mov":case"rmvb":return"fa fa-file-video";case"doc":case"docx":case"gdoc":case"txt":case"md":return"fa fa-file-text-o";case"mp3":case"flac":case"m4v":case"wav":case"aiff":case"mid":case"wma":case"midi":return"fa fa-file-audio-o";case"zip":case"rar":case"tar":case"gz":case"7z":return"fa fa-file-archive-o";case"jpg":case"png":case"jpeg":case"gif":case"psd":case"tiff":return"fa fa-file-image-o";case"cpp":case"java":case"py":case"rb":case"c":return"fa fa-file-code-o";case"pdf":return"fa fa-file-pdf-o";case"ppt":case"pptx":case"keynote":return"fa fa-file-powerpoint-o";case"xls":case"xlsx":return"fa fa-file-excel-o";default:return"fa fa-file-o"}}}angular.module("clientApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","ngMaterial"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/browse",{templateUrl:"views/browse.html",controller:"BrowseCtrl"}).when("/dashboard",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("clientApp").controller("MainCtrl",["$scope",function(){}]),angular.module("clientApp").controller("LandingCtrl",["$scope","$resource","formValidateService","connectService",function(a,b,c,d){var e=[],f=[],g=a.form={uid:"",name:"",email:"",upw:"",upwc:"",width:"280px",identifier:"Email"},h={EMAIL:"Email",USER_ID:"User ID"},i=a.Selection={DEPLOY:"deploy",LOGIN:"login",REGISTER:"register"};a.loading=!1,a.selection=i.DEPLOY,a.buttonText="Deploy",a.usingIdentifier=h.EMAIL;var j=b("/api/account/info"),k=a.Error={errors:[],needUpdate:!1,add:function(a){this.needUpdate=!0,this.errors.push(a)},hideThenClear:function(){var b=this;this.updateView(!1,function(){b.needUpdate=!1,b.errors=[],a.$apply()})},clear:function(){0!=this.errors.length&&(this.needUpdate=!0,this.errors=[])},updateView:function(a,b){("undefined"!=typeof a||0!=this.needUpdate)&&("undefined"==typeof a&&(a=this.needUpdate),$("#errmsg").transition(a?{animation:"fade down in",onComplete:b}:{animation:"fade up out",onComplete:function(){"function"==typeof b&&b()}}))}};a.formChange=function(b,c){a.selection==i.REGISTER&&(a.usingIdentifier=h.EMAIL,c&&"uid"==c&&console.log(b))},a.idChange=function(){a.selection==i.LOGIN&&a.select("deploy"),a.selection!=i.REGISTER&&(a.usingIdentifier=c.validateEmail(g.email)?h.EMAIL:h.USER_ID)},a.select=function(b){switch(a.selection=b,b){case i.LOGIN:$(".deploy.tab").removeClass("select"),$(".deploy.tab.login").addClass("select"),g.width="300px",g.identifier=a.usingIdentifier,a.usingIdentifier==h.USER_ID&&g.uid&&(g.email=g.uid,g.uid=""),a.buttonText="Login",$(".sign-up-input.password")[0].focus();break;case i.REGISTER:$(".deploy.tab").removeClass("select"),$(".deploy.tab.register").addClass("select"),g.width="400px",g.identifier="Email",a.usingIdentifier==h.USER_ID&&g.email&&(g.uid=g.email,g.email=""),a.buttonText="Register";break;case i.DEPLOY:$(".deploy.tab").removeClass("select"),g.width="300px",g.identifier="Email",a.buttonText="Deploy"}},a.deploy=function(){a.loading=!0,a.usingIdentifier=c.validateEmail(g.email)?h.EMAIL:h.USER_ID;var b={};a.usingIdentifier==h.EMAIL?b.email=g.email:b.uid=g.email;var d=j.get(b,function(){console.log(d),a.loading=!1,d.success?(e.push(d.userInfo.id),d.userInfo.email&&f.push(d.userInfo.email),a.select("login")):d.notFound?a.select("register"):console.log(d)})},a.login=function(){a.loading=!0,d.login(g.email,g.upw,function(){window.location="/console/"},function(b){switch(a.loading=!1,b.status){case 400:k.add("400 Bad Request");break;case 401:k.add("Incorrect password or invalid account credentials");break;default:k.add("Unknown Error, Status code:"+b.status)}k.updateView()})},a.register=function(){a.loading=!0,d.register(g.uid,g.name,g.email,g.upw,function(){window.location="/console/"},function(b){if(a.loading=!1,"undefined"==typeof b.success)switch(b.status){case 400:k.add("400 Bad Request");break;case 401:k.add("Incorrect password or invalid account credentials");break;default:k.add("Unknown Error, Status code:"+b.status)}else k.add(b.msg?b.msg:"Unknown Error");k.updateView()})},a.buttonClick=function(){switch(k.clear(),a.selection){case i.DEPLOY:g.email?a.deploy():(k.add("Your email address cannot be empty"),k.updateView());break;case i.LOGIN:a.login();break;case i.REGISTER:g.email?a.register():(k.add("Your email address cannot be empty"),k.updateView())}}}]),angular.module("clientApp").controller("BrowseCtrl",["$scope","UserInfo","Tools","Drive",function(a,b,c,d){a.drivelist=[],b.onchange(a,function(){var e=b.get();a.drivelist=e.drives,c.selectElement("#driveTabs>.item",function(a){a.tab()},a.drivelist.length+1,50);for(var f in a.drivelist){var g=a.drivelist[f];g.drive=new d(g.type,g.id)}}),b.update(),a.select=function(a){console.log(a)},a.switchAndView=function(a,b){$("#driveTabs>.item").tab("change tab",b.id),angular.element("#"+b.id).scope().getFileIndex(a)},a.getDriveName=function(a){switch(a){case"dropbox":return"Dropbox";case"googledrive":return"Google Drive";case"onedrive":return"One Drive";default:return"Unknown"}}}]).controller("CombinedView",["$scope","UserInfo","Drive",function(a,b,c){function d(){e=b.get(),f=[];for(var a in e.drives){var d=e.drives[a];f.push(new c(d.type,d.id))}}var e=null,f=[];a.files=[];a.drive={id:null,type:"all",drive_list:f};a.getFileIndex=function(b){function c(d){return d<f.length?f[d].listFromServer(b).then(function(b){if(b.success){var c=b.content.map(function(a){return a.drive=f[d],a});a.files.push.apply(a.files,c)}return++d}).then(c):void 0}a.files=[],c(0)},a.getClass=_browse_getClass_,b.onchange(a,d),d(),setTimeout(a.getFileIndex,100)}]).controller("SingleDriveCtrl",["$scope","$resource",function(a){var b=a.drive=null;a.currentPath=null,a.parentIndex=null,a.files=[],a.getFileIndex=function(c){a.currentPath=c,b.list(c,function(b){a.files=b.files,a.parentIndex=b.metadata.parent_identifier},function(b){a.currentPath==c&&(a.files=b)})},a.init=function(c){b=a.drive=c,a.parentIndex=b.rootPath,a.getFileIndex()},a.getClass=_browse_getClass_,a.getFileTypeName=_browse_getFileType_}]),angular.module("clientApp").service("Tools",function(){return{selectElement:function(a,b,c,d,e){function f(){var h=$(a);return!c&&h.length?b(h):void(h.length===c?b(h):--g?setTimeout(f,d):console.log("Tool.selectElement:: tried "+e+" times still can not select target element "+a))}d=d||100;var g=e=e||10;f()},timeAgo:function(a){var b=new Date,c=b-a,d=c/1e3,e=d/60,f=e/60,g=f/24;if(60>d){var h=Math.floor(d),i=1==h?"":"s";return h+" second"+i+" ago"}if(60>e){var j=Math.floor(e),i=1==j?"":"s";return j+" min"+i+" ago"}if(24>f){var k=Math.floor(f),i=1==k?"":"s";return k+" hour"+i+" ago"}if(7>g){var l=Math.floor(g),i=1==l?"":"s";return l+" day"+i+" ago"}return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()}}}),angular.module("clientApp").factory("UserInfo",["$rootScope","$resource",function(a,b){var c=b("/api/account/info"),d={};return d.info={},d.error={code:0,msg:"unknown error"},d.set=function(b){d.info=b,a.$emit("onUserInfoChange")},d.get=function(a,b,e){if(!a)return d.info;var f=c.get({uid:a},function(){f.success?b(f.userInfo):e(f)})},d.update=function(){var b=c.get({},function(){b.success?d.set(b.userInfo):(d.logined||(d.error=b),a.$emit("onUserInfoError"),console.log(b))})},d.onchange=function(b,c){if("function"==typeof b)return c=b,console.log(new Error("you should pass scope to onchange for unbind uses - Factory:userInfo.onchange()")),void a.$on("onUserInfoChange",c);var e=a.$on("onUserInfoChange",function(){c(d.get())});b.$on("$destroy",e)},d.onerror=function(b,c){if("function"==typeof b)return console.log(new Error("you should pass scope to onchange for unbind uses - Factory:userInfo.onchange()")),void a.$on("onUserInfoError",c);var e=a.$on("onUserInfoError",function(){c(d.error)});b.$on("$destroy",e)},d.update(),d}]),angular.module("clientApp").service("Task",["$q",function(a){var b=function(a,b,c){this.id=a||"AnonymousTask",this.subTask=[],this.status="pending",this.progress=0,this.expectTimeUses=b,this.timesLeft=b,this.subTaskFailed=!1,this.totalItems=1,"function"==typeof c&&(this.execute=c)};return b.prototype.execute=function(a){a()},b.prototype.addSubTask=function(a){this.subTask.push(a),this.totalItems+=a.totalItems},b.prototype.onSubTaskProgress=function(){},b.prototype.onSubTaskFail=function(){},b.MonitorTask=function(a){b.call(this,a,0),this.totalItems=0},b.MonitorTask.prototype=Object.create(b.prototype),b.MonitorTask.prototype.constructor=b.MonitorTask,b.prototype.handle=function(b){var c=this;return console.log(this),a(function(a){a()}).then(function(){function b(a){a&&f.notify(a),f.resolve("finished")}function d(a){f.notify("fail"),f.resolve(a)}function e(a){var b=new Date,d=a-c.lastProgress,e=(b-c.lastUpdate)/1e3,g=(1-a)/d*e;c.timesLeft=g,f.notify(a),c.lastUpdate=b,c.lastProgress=a}c.status="processing",c.lastUpdate=new Date,c.lastProgress=0;var f=a.defer();return setTimeout(function(){c.execute(b,d,e)},0),f.promise}).then(function(a){"fail"===c.status?c.error=a:c.status=c.subTaskFailed?"subTaskFailed":a},null,function(a){"fail"===a?c.status="fail":c.progress=a,b&&b(c,a)})},b.prototype.executeAll=function(a){function b(b,d){"fail"==d?(c.subTaskFailed=!0,c.onSubTaskFail(b)):c.onSubTaskProgress(b,d),a&&a(c,d)}var c=this;return c.status="processing",this.executeSubTasks(b).then(function(){return c.handle(a)})["catch"](function(a){c.status="fail",c.error=a})},b.prototype.executeSubTasks=function(b){function c(a){return d.subTask[a].executeAll(b).then(function(){return a+1<d.subTask.length?c(a+1):"all subtask finished"})}var d=this;return d.subTask[0]?c(0):a(function(a){a("all subtask finished")})},b.MonitorTask.prototype.onSubTaskProgress=function(){if(this.subTask.length){var a=0,b=0;for(var c in this.subTask){var d=this.subTask[c];"fail"!=d.status&&(a+=d.progress,b+=d.timesLeft)}a/=this.subTask.length,this.progress=a,this.timesLeft=b}},b.MonitorTask.prototype.addSubTask=function(a){this.subTask.push(a),this.expectTimeUses+=a.expectTimeUses,this.timesLeft=this.expectTimeUses,this.totalItems+=a.totalItems},b.MonitorTask.prototype.execute=function(a,b,c){0==this.subTask.length&&c(1),a()},b}]),angular.module("clientApp").service("UploadTask",["Task","$q",function(a,b){var c="/test/uploadtask/",d=function(b,c,d){a.call(this,c.name,d.size/8388608),this.file=d,this.webkitEntry=c,this.destination=b};d.prototype=Object.create(a.prototype),d.prototype.constructor=d,d.prototype.execute=function(a,b,d){function e(){}function f(a){b(a)}function g(a){a.lengthComputable&&d(a.loaded/a.total)}var h=this.file,i=this.webkitEntry,j=this.destination,k=h,l=new FormData,m=i.fullpath;l.append("path",j+m),l.append("filesize",h.size),l.append("file",k),$.ajax({url:c,type:"post",xhr:function(){var a=$.ajaxSettings.xhr();return a.upload&&a.upload.addEventListener("progress",g,!1),a},beforeSend:e,success:function(b){console.log(b),a(1)},error:f,data:l,cache:!1,contentType:!1,processData:!1})};var e=function(b,c,d){a.call(this,c.name,d.size/8388608)};e.prototype=Object.create(a.prototype),e.prototype.constructor=e,e.prototype.execute=function(){};var f=function(b,c){a.MonitorTask.call(this,c.name,0)};f.prototype=Object.create(a.MonitorTask.prototype),f.prototype.constructor=f,f.prototype.execute=function(a,b,c){0==this.subTask.length&&c(1),a()};var g=function(a,c){function d(a){return b(function(b){var c=a.createReader();c.readEntries(function(a){b(a)})})}return d(c).then(function(b){function d(c){return c<b.length?i(a,b[c]).then(function(a){return e.addSubTask(a),c+1}).then(d):e}var e=new f(a,c);return d(0)})},h=function(a,c){function e(a){return b(function(b){a.file(function(a){b(a)})})}return e(c).then(function(b){return new d(a,c,b)})},i=function(a,b){return b.isFile?h(a,b):b.isDirectory?g(a,b):void 0};return{Task:a,MultipartTask:d,ChunckedTask:e,FolderTask:f,createSuitableTask:i,createFileTask:h,createFolderTask:g}}]),angular.module("clientApp").service("DriveCache",["$resource","$rootScope",function(a,b){var c=a("/api/drive/:driveId/cache/"),d=a("/api/drive/:driveId/cache/update/"),e=function(a,b){this.type=a,this.id=b,this.onRetrivedEvent="onCacheRetrived"+this.id,this.onUpdatedEvent="onCacheUpdated"+this.id,this.cachedIndex={},this.lastUpdate=null};return e.prototype.getMetadata=function(a){return a=a||this.cachedIndex.rootIndex,this.cachedIndex[a]},e.prototype.getFileList=function(a){a=a||this.cachedIndex.rootIndex;var b=this.cachedIndex[a];if(!b)return null;var c=this,d=b.files.map(function(a){return c.cachedIndex[a]});return d},e.prototype.requestSync=function(a){var c=this;return d.get({driveId:this.id}).$promise.then(function(d){d.success?(c.lastUpdate=d.lastUpdate,c.cachedIndex=JSON.parse(d.cachedIndex),b.$emit(c.onUpdatedEvent)):(console.log(d),a&&a(d))},function(b){console.log(b),a&&a(b)})},e.prototype.retrive=function(a){var d=this;return c.get({driveId:this.id}).$promise.then(function(c){c.success?(d.lastUpdate=c.lastUpdate,d.cachedIndex=JSON.parse(c.cachedIndex),b.$emit(d.onRetrivedEvent)):(console.log(c),a&&a(c))},function(b){console.log(b),a&&a(b)})},e.prototype.onRetrived=function(a,c){var d=this;if("function"==typeof a)return c=a,console.log(new Error("you should pass scope to onRetrived for unbind uses - Service:DriveCache.onchange()")),void b.$on(this.onRetrivedEvent,function(){c(d)});var e=b.$on(this.onRetrivedEvent,function(){c(d)});a.$on("$destroy",e)},e.prototype.onUpdated=function(a,c){var d=this;if("function"==typeof a)return c=a,console.log(new Error("you should pass scope to onRetrived for unbind uses - Service:DriveCache.onchange()")),void b.$on(this.onUpdatedEvent,function(){c(d)});var e=b.$on(this.onUpdatedEvent,function(){c(d)});a.$on("$destroy",e)},e}]),angular.module("clientApp").service("Drive",["$resource","DriveCache","$q",function(a,b,c){var d=function(a,c){var d=this;switch(this.type=a,this.id=c,this.cacheReady=!1,this.cache=new b(a,c),this.cacheInitPromise=this.cache.retrive(function(a){console.log("retirved error, should be try again but not implemented, error:"),console.log(a)}).then(function(){d.cacheReady=!0}),this.cacheInitPromise.then(function(){d.initCallback&&d.initCallback()}),a){case"dropbox":this.rootPath="/";break;case"googledrive":this.rootPath="root";break;case"onedrive":this.rootPath="me/skydrive";break;default:console.log(new Error("Unsupported drive type on Constructor::service::Drive"))}};d.prototype.list=function(a,b,d){var e,f=this;e=this.cacheReady?this.listFromCache(a).then(function(a){b(a)},function(a){console.log(a)}):c(function(a){a()}),e.then(function(){return f.listFromServer(a)}).then(function(a){a.success?d(a.content):(console.log("result not success"),console.log(a))},function(a){console.log(a)})},d.prototype.listFromCache=function(a){function b(){return c(function(b){var c=d.cache.getMetadata(a),e=d.cache.getFileList(a);b({metadata:c,files:e})})}var d=this;return this.cacheReady?b():c(function(a){d.initCallback=function(){d.cacheReady=!0,a()}}).then(b)};var e=a("/api/drive/:driveId/:fileId/list/");return d.prototype.listFromServer=function(a){return a=a||this.rootPath,e.get({driveId:this.id,fileId:a}).$promise},d.prototype.downloadLink=function(a){return"/api/drive/"+this.id+"/"+a+"/download"},d.prototype.info=function(){throw new Error("function not implemented")},d}]),angular.module("clientApp").service("notifier",function(){this.notify=function(){},this.error=function(){},this.success=function(){},this.send=function(){}}).factory("messageFactory",function(){}),angular.module("clientApp").service("formValidateService",["UserInfo",function(a){return this.passowrdMatch=function(a,b){return a===b?!0:!1},this.passwordComplexityCheck=function(a){var b={uppercaseCharacter:/[A-Z]/,lowercaseCharacter:/[a-z]/,digit:/\d/,other:/\W/},c=b.uppercaseCharacter.test(a)+b.lowercaseCharacter.test(a)+b.digit.test(a)+b.other.test(passowrd);return c+a.length},this.validateEmail=function(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)},this.IsUsernameTaken=function(b){a.get(b,function(){})},this}]),angular.module("clientApp").controller("UserCtrl",["$mdDialog","$scope","$resource",function(a,b,c){b.showLogoutConfirm=function(b){var d=c("/logout"),e=a.confirm().title("Would you like to log off the system?").content("You will have to login again to gain access to your cloud storage.").ok("Logout").cancel("Cancel").targetEvent(b);a.show(e).then(function(){var a=d.save({},function(){a.success&&0==a.logined&&(window.location="/")})},function(){a.cancel()})}}]),angular.module("clientApp").controller("DashboardCtrl",["$scope",function(){}]),angular.module("clientApp").controller("SettingsCtrl",["$scope",function(){}]),angular.module("clientApp").controller("Menu",["$scope","Tools",function(a,b){var c=!1;a.options=[{icon:"fa-home",name:"Home",route:"/"},{icon:"fa-heart",name:"Favs",route:"/"},{icon:"fa-folder",name:"Files",route:"/browse"},{icon:"fa-tachometer",name:"Stats",route:"/"}];var d,e=$(document.body);b.selectElement("#sm-open-button",function(a){d=a[0]},1,50),a.toggleMenu=function(){c?e.removeClass("show-menu"):e.addClass("show-menu"),c=!c},a.closeMenuIfOpened=function(b){var e=b.target;c&&e!==d&&a.toggleMenu()}}]),angular.module("clientApp").controller("Topbar",["$scope","UserInfo","User",function(a,b,c){a.defaultPhoto="/images/Nyan-Cat.jpg",a.user=b.get(),a.getUserPhoto=function(){return a.user?a.user.photo||a.defaultPhoto:a.defaultPhoto},a.getIconByCode=function(a){if(!a)return"fa-info-circle";switch(a){case 151:return"fa-refresh";case 303:return"fa-link";case 401:return"fa-sign-in";default:return"fa-info-circle"}},b.onchange(a,function(b){console.log(b),a.user=b,c.getLogs(6).then(function(b){b.success?(a.user.notification=b.logs.map(function(a){return a}),console.log("$scope.user.notification:"),console.log(a.user.notification)):console.log(b)})}),b.onerror(a,function(a){a.logined||(window.location="/")}),setTimeout(function(){$(".ui.floating.labeled.icon.dropdown").dropdown(),$("#displayNotification").popup({lnline:!0,on:"click",position:"bottom right",setFluidWidth:"true"})},300)}]).directive("timeAgo",["$interval","Tools",function(a,b){function c(c,d){function e(){d.text(b.timeAgo(c.time))}var f;c.time=new Date(c.time),d.on("$destroy",function(){a.cancel(f)}),f=a(function(){e()},1e3)}return{link:c,restrict:"E",terminal:!0,scope:{time:"="}}}]),angular.module("clientApp").controller("DriveManager",["$scope","UserInfo","$location","Tools",function(a,b,c,d){a.drives={googledrive:{type:"googledrive",name:"Google Drive",icon:"/images/googledrive.png",accounts:[]},onedrive:{type:"onedrive",name:"One Drive",icon:"/images/onedrive.png",accounts:[]},dropbox:{type:"dropbox",dropbox:"dropbox",name:"Dropbox",icon:"/images/dropbox.png",accounts:[]}};var e=c.search();a.success=null,a.error=null,a.rediectDriveType=null;a.userInfo=b.get();b.onchange(a,function(){a.userInfo=b.get(),a.userInfoUpdate()}),a.open=function(a){d.selectElement("#manageDriveModal",function(b){b=a?b.modal("setting","duration",0):b.modal("setting","duration",400),b.modal("show")},1,50,30)},a.userInfoUpdate=function(){0==a.userInfo.drives.length&&a.open();for(var b in a.drives)a.drives[b].accounts=[];for(var c in a.userInfo.drives){var d=a.userInfo.drives[c];a.drives[d.type].accounts.push({email:d.id,id:d.id})}},a.initByParams=function(){e.redirect&&"drive"==e.redirect&&(a.open(!0),a.success=e.success,a.error=e.error,a.rediectDriveType=e.drive,delete c.$$search.redirect,delete c.$$search.drive,delete c.$$search.error,delete c.$$search.success,c.$$compose())},a.userInfoUpdate(),a.initByParams()}]).controller("SingleDriveManage",["$scope","$element",function(a,b){var c="Manage",d="settings",e="Save",f="save";a.manageBtnTxt=c,a.manageBtnIco=d,a.toogleManageSegment=function(){a.manageBtnTxt==c?(a.manageBtnTxt=e,a.manageBtnIco=f):(a.manageBtnTxt=c,a.manageBtnIco=d),$(b).find(".manageDriveSegment").slideToggle("fast")},a.addDrive=function(){window.location="/api/auth/"+a.drive.type},a.revoke=function(){}}]),angular.module("clientApp").service("User",["$q","$resource",function(a,b){var c=b("/api/account/log");return{getLogs:function(a){return c.get({limit:a||20}).$promise},getNotification:function(){}}}]),angular.module("clientApp").service("connectService",["formValidateService","UserInfo","$resource",function(a,b,c){this.login=function(a,b,d,e){var f=c("/login"),g=f.save({uid:a,upw:b,strategy:"local"},function(){g.success?d(g):e(g)});g.$promise["catch"](function(a){e(a)})},this.register=function(a,b,d,e,f,g){var h=c("/register"),i=h.save({uid:a,name:b,email:d,upw:e,strategy:"local"},function(){i.success?f():g(i)});i.$promise["catch"](function(a){error_callback(a)})},this.isUserAuthenticated=function(){return b.get().logined}}]),angular.module("clientApp").controller("uploadCtrl",["$scope","UploadTask","$q",function(a,b,c){function d(){$("#bgdiv").css("background-color","#ffd"),$("#upload_grid").addClass("onupload"),$("#ani").addClass("play")}function e(){$("#bgdiv").css("background-color","#fff"),$("#upload_grid").removeClass("onupload"),$("#ani").removeClass("play")}function f(){event.stopPropagation(),event.preventDefault()}function g(){event.stopPropagation(),event.preventDefault();for(var c=$(this)[0].files,d=0;d<c.length;d++){var e=c[d];j.addSubTask(new b.MultipartTask("root",e,e))}a.$apply()}function h(){e(),event.stopPropagation(),event.preventDefault(),$("#msg").html("geting data");{var a=event.dataTransfer.items;event.dataTransfer.files}a[0]&&a[0].webkitGetAsEntry&&i(a).then(function(){})}function i(a){function d(a){return a?b.createSuitableTask("root",a).then(function(a){return j.addSubTask(a),j}):c(function(a){a(j)})}function e(b){if(b<a.length){var f=a[b].webkitGetAsEntry();return d(f).then(function(){return e(b+1)})}return c(function(a){a(j)})}return e(0)}var j=a.task=new b.Task.MonitorTask("rootTask");setTimeout(function(){$("#ajaxfile").on("change",g),$("#ajaxfolder").on("change",g),$(document).on("dragenter",d),$("#upload_grid").on("dragleave",e),$("#upload_grid").on("dragover",f),$("#upload_grid").on("drop",h)},500),a.selectFiles=function(){$("#ajaxfile").trigger("click")},a.selectFolders=function(){$("#ajaxfolder").trigger("click")},a.startUpload=function(){j.executeAll().then(function(){console.log("finish")})}}]),angular.module("clientApp").controller("taskDirectiveCtrl",["$scope",function(a){a.openst=!1,a.Math=Math}]).directive("task",function(){return{restrict:"E",scope:{val:"="},templateUrl:"/views/task.html",controller:"taskDirectiveCtrl"}}).directive("subTasks",["$compile",function(a){function b(b,c){function d(){b.val.length&&c.html(e),a(c.contents())(b.$new())}var e='<task ng-repeat="task in val" val="task"></task>';d(),b.$watchCollection("val",function(){d()},!0)}return{restrict:"E",terminal:!0,scope:{val:"="},link:b}}]),angular.module("clientApp").service("xfs",function(){});